var currentNumberOfContent=0;var maxNumberOfContent=1000;var currentTotalContent=0;var isNoMoreData=false;var content;var theUser;function getContent(tempUser,callback){$.post("/getContentFromUser",{startNum:0,endNum:maxNumberOfContent,userID:tempUser.UserID}).done(function(data){currentTotalContent=data.length;content=data;theUser=tempUser;callback()})}function getContentForCategory(category,tempUser,callback){$.post("/getContentForCategory",{startNum:0,endNum:maxNumberOfContent,category:category.CategoryID}).done(function(data){currentTotalContent=data.length;content=data;theUser=tempUser;callback()})}function loadInContent(masonryContainer){if(content!=undefined&&currentNumberOfContent!=currentTotalContent)continueLoading(masonryContainer);else{noMoreData(masonryContainer)}}function continueLoading(masonryContainer){for(var i=currentNumberOfContent;i<currentNumberOfContent+14;i++){var tempcontent=content[i];if(tempcontent==undefined){currentNumberOfContent=i;noMoreData(masonryContainer);break}appendContent(tempcontent,masonryContainer);if(tempcontent.IsLike!=null)displayHasLike(tempcontent.IsLike,tempcontent.ContentID,tempcontent.Ratio);masonryContainer.masonry('reload')}currentNumberOfContent=i;masonryContainer.masonry('reload')}function noMoreData(masonryContainer){if(!isNoMoreData){appendNoMoreDataWarning(masonryContainer);masonryContainer.masonry('reload')}isNoMoreData=true}function appendNoMoreDataWarning(masonryContainer){var theString='<div class="item Wide centeredInDiv dislikeDiv" style="height:40px;'+'width: 100%; background-color: #903; vertical-align: middle;">'+'Sorry, no more data.</div>';var $boxes=$(theString);masonryContainer.append($boxes).masonry('appended',$boxes)}function appendContent(content,masonryContainer){var el=document.createElement("option");var imageWidth;var imageHeight;imageWidth=200;imageHeight=(200/content.Width)*content.Height;var bottomHeight=80;var contentHeight=imageHeight+bottomHeight;var theString='<div class="item Wide" style="height:'+contentHeight+'px; width: +'+imageWidth+';"><img class="contentImg" id="ContentImage_'+content.ContentID+'" width="'+imageWidth+'" src="/public/images/'+content.ContentID+'-small.png"/><br/>'+content.Title+'<br/>'+getBottom(content)+'</div>';var $boxes=$(theString);masonryContainer.append($boxes).masonry('appended',$boxes)}function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}function getBottom(content){if(content!=undefined){var likesToDislikes=content.Likes-content.Dislikes;var likesColorClass;if(likesToDislikes>0){likesColorClass='greenP'}else if(likesToDislikes<0){likesColorClass='redP'}else{likesColorClass='redP';likesToDislikes='No likes/dislikes'}returnS='<center> <div id="likeAndDislikeDiv_'+content.ContentID+'">'+'<div class="centeredInDiv likeDiv" id="likeDiv_'+content.ContentID+'" name="'+content.ContentID+'">like</div>'+'<div class="centeredInDiv spacerDiv" id="spacerDiv_'+content.ContentID+'" name="'+content.ContentID+'"></div>'+'<div class="centeredInDiv dislikeDiv" id="dislikeDiv_'+content.ContentID+'" name="'+content.ContentID+'">dislike</div>'+'</div></center>'+'<div>'+'<div class="centeredInDiv haveLikedDiv" id="haveLikedDiv_'+content.ContentID+'" name="'+content.ContentID+'"></div>'+'<div class="centeredInDiv likesVsDislikesDiv" id="likesVsDislikesDiv_'+content.ContentID+'" name="'+content.ContentID+'">'+'<p class="'+likesColorClass+'">'+likesToDislikes+'</p></div>'+'</div>';return returnS}return""}$(document).delegate("div[id^='haveLikedDiv']","click",function(){var el=this;changeLike($(el).attr('name'))});$(document).delegate("div[id^='likeDiv']","click",function(){var el=this;haveLikedOrDislikedObject(0,$(el).attr('name'),theUser)});$(document).delegate("div[id^='dislikeDiv']","click",function(){var el=this;haveLikedOrDislikedObject(1,$(el).attr('name'),theUser)});function changeLike(contentNumber){$("#likesVsDislikesDiv_"+contentNumber).fadeOut(1000);$("#haveLikedDiv_"+contentNumber).fadeOut(1000,function(){$("#likeAndDislikeDiv_"+contentNumber).fadeIn(1000)})}function haveLikedOrDislikedObject(res,contentNumber,user){if(user!=undefined){if(res==0){$("#haveLikedDiv_"+contentNumber).text("Processing...");$.post("/likeContent",{content:contentNumber,user:user.UserID,isLike:1}).done(function(data){var numLikes=data.numberOfLikes;displayHasLike(1,contentNumber,numLikes)}).fail(function(){$("#haveLikedDiv_"+contentNumber).text("Error liking this object...")})}else{$.post("/likeContent",{content:contentNumber,user:user.UserID,isLike:0}).done(function(data){var numLikes=data.numberOfLikes;displayHasLike(0,contentNumber,numLikes)}).fail(function(){$("#haveLikedDiv_"+contentNumber).text("Error liking this object...")})}}else{$("#haveLikedDiv_"+contentNumber).text("Sorry, something went wrong.")}};function displayHasLike(hasLike,contentNumber,numLikes){$("#likeAndDislikeDiv_"+contentNumber).fadeOut(400,function(){$("#haveLikedDiv_"+contentNumber).fadeIn(1000);$("#likesVsDislikesDiv_"+contentNumber).fadeIn(1000)});if(hasLike==1)$("#haveLikedDiv_"+contentNumber).text("You like this.");else $("#haveLikedDiv_"+contentNumber).text("You dislike this.");$("#likesVsDislikesDiv_"+contentNumber).text(numLikes)}function handleLoadingContent(theUser){$('#container').masonry({itemSelector:'.item',isFitWidth:true,isAnimated:true});$(window).scroll(function(){if($(window).scrollTop()==$(document).height()-$(window).height()){loadInContent($('#container'))}});loadInContent($('#container'))}